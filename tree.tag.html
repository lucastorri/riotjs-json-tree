<tree>

  <div class="tree-controls" if={ isRoot }>
    <a onclick={ toggleAll }>toggle</a>
  </div>

  <span if={ isObject } class="tree-node tree-node-object">
    &#123; <a onclick={ toggle }>{ show ? '-' : '+' }</a>
    <ul if={ show || showAll }>
      <li each={ element in Object.entries(obj) } >
        <span class="tree-key">{ element[0] }</span>
        <tree obj={ element[1] } show-depth={ opts.showDepth - 1 } show-all={ showAll } path={ '.' + element[0] } />
      </li>
    </ul>
    &#125;
  </span>

  <span if={ isArray } class="tree-node tree-node-array">
    [
    <a onclick={ toggle }>{ show ? '-' : '+' }</a>
    <ul if={ show || showAll }>
      <li each={ element, index in obj }>
        <tree obj={ element } show-depth={ opts.showDepth - 1 } show-all={ showAll } path={ '[' + index + ']' } />
      </li>
    </ul>
    ]
  </span>

  <span if={ isLeaf } class="tree-leaf tree-leaf-{ type(obj) }" data-path={ path }>{ JSON.stringify(obj) }</span>

  <script>
    this.type = obj => {
      if (Array.isArray(obj)) return "array";
      else if (obj === null) return "null";
      else return typeof obj;
    };

    this.isRoot = this.parent === null;
    this.path = this.isRoot ? '' : this.parent.path + opts.path;

    this.obj = opts.obj;
    this.isArray = this.type(this.obj) === "array";
    this.isObject = this.type(this.obj) === "object";
    this.isLeaf = !(this.isArray || this.isObject);

    this.showAll = opts.showAll || false;
    this.show = opts.showDepth > 0 || opts.show || false;

    this.toggle = () => {
      this.update({
        show: !this.show,
        showAll: false
      });
    };

    this.toggleAll = () => {
      this.update({
        show: !this.show,
        showAll: !this.show
      });
    };
  </script>

</tree>
